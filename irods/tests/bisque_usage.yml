---
- name: Verify BisQue support removed
  hosts: irods_catalog
  strategy: linear
  become: true
  become_user: irods
  tasks:
    - name: Verify bisque files removed
      ansible.builtin.stat:
        path: "{{ item }}"
      with_items:
        - /etc/irods/bisque.re
        - /etc/irods/bisque-env.re
        - /var/lib/irods/.bisque
        - /var/lib/irods/msiExecCmd_bin/bisque_paths.py
        - /var/lib/irods/msiExecCmd_bin/url-encode-path-segments.sh
      register: resp
      failed_when: resp.stat.exists

    - name: Verify BisQue iRODS account removed  # noqa: run-once[task]
      run_once: true
      ansible.builtin.shell:
        executable: /bin/bash
        cmd: |
          set -o pipefail
          iadmin lu bisque | grep --quiet 'No rows found'
      changed_when: false
